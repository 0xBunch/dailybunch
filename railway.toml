[build]
builder = "NIXPACKS"
nixpacksConfigPath = "nixpacks.toml"

[deploy]
startCommand = "npx prisma db push --skip-generate && npm run start -- --port ${PORT:-3000}"
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Cron jobs for auto-updating content
[[crons]]
name = "rss-poll"
schedule = "*/15 * * * *"
endpoint = "/api/ingest/poll"

[[crons]]
name = "enrich-links"
schedule = "*/5 * * * *"
endpoint = "/api/cron/enrich"

[[crons]]
name = "analyze-links"
schedule = "*/10 * * * *"
endpoint = "/api/cron/analyze"

[[crons]]
name = "cultural-analysis"
schedule = "0 */2 * * *"
endpoint = "/api/cron/cultural-analysis"

[[crons]]
name = "commentary"
schedule = "30 */2 * * *"
endpoint = "/api/cron/commentary"

[[crons]]
name = "trends"
schedule = "0 */6 * * *"
endpoint = "/api/cron/trends"

[[crons]]
name = "clustering"
schedule = "30 */6 * * *"
endpoint = "/api/cron/clustering"
